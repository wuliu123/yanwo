<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>网站管理系统后台v1</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="A fully featured admin theme which can be used to build CRM, CMS, etc." name="description" />
    <meta content="Coderthemes" name="author" />
    <!-- App favicon -->
    <link rel="shortcut icon" href="../assets/images/favicon.png">

    <!-- Summernote css -->
    <link href="../assets/css/vendor/summernote-bs4.css" rel="stylesheet" type="text/css" />
    <!-- SimpleMDE css -->
    <link href="../assets/css/vendor/simplemde.min.css" rel="stylesheet" type="text/css" />

    <!-- App css -->
    <link href="../assets/css/icons.min.css" rel="stylesheet" type="text/css" />
    <link href="../assets/css/app.min.css" rel="stylesheet" type="text/css" />

    <link href="../css/bootstrap-fileinput.css" rel="stylesheet">
    <script src="http://www.jq22.com/jquery/jquery-1.10.2.js"></script>
    <style>
        .CarouserlMap{
           width: 20%;
        }
    </style>
</head>

<body>

    <!-- Begin page -->
    <div class="wrapper">
        <!-- ========== Left Sidebar Start ========== -->
        <div class="left-side-menu">
            <div class="slimscroll-menu" id="left-side-menu-container">
                <!-- LOGO -->
                <a href="index.html" class="logo text-center">
                    <span class="logo-lg">                       
                        网站管理系统后台v1
                    </span>
                </a>
                <!--- Sidemenu -->
                <ul class="metismenu side-nav">
                    <li class="side-nav-title side-nav-item">控制台</li>
                    <li class="side-nav-item">
                        <a href="javascript: void(0);" class="side-nav-link">
                            <i class="dripicons-meter"></i>
                            <span class="badge badge-success float-right">3</span>
                            <span> 信息管理台 </span>
                        </a>
                        <ul class="side-nav-second-level" aria-expanded="false">
                            <li>
                                <a href="Carouselmap.html">轮播图</a>
                            </li>
                            <li>
                                <a href="navigationbar.html">导航栏</a>
                            </li>
                            <li>
                                <a href="index.html">发布文章</a>
                            </li>
                            <li>
                                <a href="articlelist.html">文章列表</a>
                            </li>
                            <li>
                                <a href="briefintroduction.html">公司简介</a>
                            </li>

                        </ul>
                    </li>
                </ul>
                <div class="clearfix"></div>
            </div>
            <!-- Sidebar -left -->
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start Page Content here -->
        <!-- ============================================================== -->

        <div class="content-page">
            <div class="content">
                <!-- Topbar Start -->
                <div class="navbar-custom">
                    <ul class="list-unstyled topbar-right-menu float-right mb-0">

                        <li class="dropdown notification-list">
                            <a class="nav-link dropdown-toggle nav-user arrow-none mr-0" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
                                <span class="account-user-avatar"> 
                                        <img src="../assets/images/users/avatar-1.jpg" alt="user-image" class="rounded-circle">
                                    </span>
                                <span>
                                        <span class="account-user-name">超级管理员</span>
                                <span class="account-position" id="username"></span>
                                </span>
                            </a>
                            <div class="dropdown-menu dropdown-menu-right dropdown-menu-animated topbar-dropdown-menu profile-dropdown">
                                <!-- item-->
                                <div class=" dropdown-header noti-title">
                                    <h6 class="text-overflow m-0">欢迎使用本系统 !</h6>
                                </div>

                                <!-- item-->
                                <a href="javascript:void(0);" class="dropdown-item notify-item">
                                    <i class="mdi mdi-account-circle mr-1"></i>
                                    <span>个人资料</span>
                                </a>

                                <!-- item-->
                                <a href="javascript:void(0);" class="dropdown-item notify-item">
                                    <i class="mdi mdi-account-edit mr-1"></i>
                                    <span>修改密码</span>
                                </a>

                                <!-- item-->
                                <a href="javascript:void(0);" class="dropdown-item notify-item">
                                    <i class="mdi mdi-lifebuoy mr-1"></i>
                                    <span>更换头像</span>
                                </a>

                                <!-- item-->
                                <a href="javascript:void(0);" class="dropdown-item notify-item">
                                    <i class="mdi mdi-lock-outline mr-1"></i>
                                    <span>退出登录</span>
                                </a>



                            </div>
                        </li>

                    </ul>
                    <button class="button-menu-mobile open-left disable-btn">
                            <i class="mdi mdi-menu"></i>
                        </button>

                </div>
                <!-- end Topbar -->

                <!-- Start Content-->
                <div class="container-fluid">

                    <!-- start page title -->
                    <div class="row">
                        <div class="col-12">
                            <div class="page-title-box">
                                <div class="page-title-right">
                                    <ol class="breadcrumb m-0">
                                        <li class="breadcrumb-item"><a href="javascript: void(0);">首页</a></li>
                                        <li class="breadcrumb-item"><a href="javascript: void(0);">信息管理台</a></li>
                                        <li class="breadcrumb-item active">上传轮播图</li>
                                    </ol>
                                </div>
                                <h4 class="page-title">上传轮播图</h4>
                            </div>
                        </div>
                    </div>
                    <!-- end page title -->

                    <div class="row">
                        <div class="col-12">
                            <div class="table-responsive-sm">
                                <table class="table table-striped table-centered mb-0">
                                    <thead>
                                    <tr>
                                        <th>轮播图片</th>
                                        <th>图片地址</th>
                                        <th>操作</th>
                                    </tr>
                                    </thead>
                                    <tbody id="CarouserlMap">

                                    </tbody>
                                </table>
                            </div> <!-- end table-responsive-->
                            <div style="height: 80px"></div>
                            <!-- 上传封面图 -->
                            <div class="page-header">
                                <h5>官网轮播图片上传</h5>
                                <form id="uploadForm" enctype='multipart/form-data'>
                                    <div class="form-group">
                                        <div class="h5">图片预览</div>
                                        <div class="fileinput fileinput-new" data-provides="fileinput"  id="exampleInputUpload">
                                            <div class="fileinput-new thumbnail" style="width: 500px;height: auto;max-height:260px;">
                                                <img id='picImg' style="width: 100%;height: auto;max-height: 260px;" src="../images/noimage.png" alt="" />
                                            </div>
                                            <div class="fileinput-preview fileinput-exists thumbnail" style="max-width: 500px; max-height: 260px;"></div>
                                            <div>
                                                <span class="btn btn-primary btn-file">
                                                    <span class="fileinput-new">选择文件</span>
                                                    <span class="fileinput-exists">换一张</span>
                                                    <input type="file" name="file" id="picID" accept="image/gif,image/jpeg,image/x-png"/>
                                                </span>
                                                <a href="javascript:;" class="btn btn-warning fileinput-exists" data-dismiss="fileinput">移除</a>
                                            </div>
                                        </div>
                                    </div>
                                    <button type="button" id="uploadSubmit" class="btn btn-info">提交</button>
                                </form>
                            </div>
                                <div style="height: 10px;"></div>
                            </div>
                        </div>
                        <!-- end col-->
                    </div>
                    <!-- end row -->
                </div>
                <!-- container -->

            </div>
            <!-- content -->

            <!-- Footer Start -->
            <footer class="footer">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-6">
                            2021-- © Hyper - Coderthemes.com
                        </div>

                    </div>
                </div>
            </footer>
            <!-- end Footer -->

        </div>

        <!-- ============================================================== -->
        <!-- End Page content -->
        <!-- ============================================================== -->


    </div>
    <!-- END wrapper -->




    <!-- /Right-bar -->


    <!-- App js -->
    <script src="../assets/js/app.min.js"></script>

    <!-- wangEditor.js -->
    <script src="../js/wangEditor.js"></script>
    <script src="../js/bootstrap-fileinput.js"></script>

    <!-- 引入 wangEditor.min.js -->
    <script type="text/javascript">
        //设置头像
        $(document).ready(function () {
            if ($.cookie('avatar') != null){
                $("#avatar").attr('src',$.cookie('avatar'))
            }
            $("#username").html($.cookie('username'))
            $.ajax({
                url: '../CarouserlMap/findAll',
                type: 'GET',
                async: false,
                cache: false,
                contentType: false,
                processData: false,
                success: function(json) {
                    console.log(json);
                    var resultlength = json.data.length
                    $("#CarouserlMap").empty();
                    for (let i = 0; i < resultlength; i++) {
                        var html =
                            '<tr>'+
                            '<td>'+
                            '<img src="/imgUrl#{url}" class="CarouserlMap" />'+
                            '</td>'+
                            '<td>#{createdTime}</td>'+
                            '<td class="table-action">'+
                            '<button type="button" class="btn btn-danger" onclick="deleteimg(#{id})">删除</button>'+
                            '</td>'+
                            '</tr>';

                        html = html.replace("#{id}", json.data[i].id);
                        html = html.replace("#{url}", json.data[i].url);
                        html = html.replace("#{createdTime}", timeFmt(json.data[i].createdTime));
                        $("#CarouserlMap").append(html);
                    }


                },
            });
        })
        //比较简洁，细节可自行完善
        $('#uploadSubmit').click(function() {
            var data = new FormData($('#uploadForm')[0]);
            console.log("data:" + data)
            $.ajax({
                url: '../CarouserlMap/insertImg',
                type: 'POST',
                data: data,
                async: false,
                cache: false,
                contentType: false,
                processData: false,
                success: function(json) {
                    console.log(json.data);
                    location.reload()
                    alert("上传成功")
                },
            });
        });


        //删除图片
        function deleteimg(id) {
            $.ajax({
                url: '../CarouserlMap/Delete/' + id,
                type: 'GET',
                async: false,
                cache: false,
                contentType: false,
                processData: false,
                success: function(json) {
                    location.reload()
                    alert("删除成功")
                },
            });
        }

        //时间格式化函数
        function timeFmt(value) {
            var date=new Date(value);
            var year=date.getFullYear();
            var month=date.getMonth()+1;
            month=month>9?month:('0'+month);
            var day=date.getDate();
            day=day>9?day:('0'+day);
            var hh=date.getHours();
            hh=hh>9?hh:('0'+hh);
            var mm=date.getMinutes();
            mm=mm>9?mm:('0'+mm);
            var ss=date.getSeconds();
            ss=ss>9?ss:('0'+ss);
            var time=year+'-'+month+'-'+day;
            return time;
        };
    </script>
    <script src="../assets/js/jquery.cookie.js"></script>
</body>

</html>